# Сливание AVHDX в VHDX
Автоматически находит виртуальные машины в текущей папке и сливает их AVHDX-диски в базовые VHDX.  

# Как использовать:
1. Поместите скрипт в папку, где лежат диски виртуальной машины (или в родительскую папку).  
Пример структуры:  
C:\VMs\  
  ├── Win10-VM1\  
  │   ├── System.vhdx  
  │   └── Diff_20240101.avhdx  
  └── Win11-VM2\  
      ├── OS.vhdx  
      └── Snapshot.avhdx  
3. Запустите PowerShell от имени администратора.  
4. cd "C:\VMs"  
5. Разрешите выполнение скриптов (если нужно):  
   Set-ExecutionPolicy RemoteSigned -Scope CurrentUser -Force  
6. Запустите скрипт:  
.\Merge-Avhdx-AutoDiscover.ps1
 
# Что произойдёт
1. Скрипт просканирует текущую папку и все подпапки на наличие .vhdx/avhdx.  
2. Сгруппирует диски по виртуальным машинам (на основе цепочки родительских дисков).  
3. Для каждой виртуальной машины:  
    выключит её (если она запущена);  
    найдёт все AVHDX и отсортирует их от нового к старому;  
    выполнит Merge-VHD для каждого AVHDX.  
4. Запишет логи в файл Merge_AVHDX_Auto_*.log в той же папке.

# Важные замечания!
Резервные копии: всегда делайте бэкап дисков перед запуском.  
Права: запустите PowerShell от имени администратора.  
Политика выполнения: если скрипт не запускается, выполните Set-ExecutionPolicy.  
Имена виртуальных машин: скрипт использует имя корневого VHDX как имя виртуальной машины (например, System.vhdx → ВМ System).  
Отсутствие виртуальных машин в Hyper‑V: скрипт продолжит слияние дисков, даже если виртуальная машина не найдена в менеджере Hyper‑V.  
